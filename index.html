<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>RK KNIT FAB â€” Job Work Ledger</title>

<style>
body {
  margin: 0;
  font-family: Poppins, sans-serif;
  background: #0f1115;
  color: white;
}

.app {
  padding: 20px;
}

h1 {
  font-size: 26px;
  font-weight: 600;
  text-align: center;
  margin-top: 10px;
}

.card {
  background: rgba(255,255,255,0.08);
  padding: 18px;
  margin: 15px 0;
  border-radius: 14px;
  backdrop-filter: blur(10px);
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
  animation: fadeIn .5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px);}
  to   { opacity: 1; transform: translateY(0);}
}

select {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  margin-top: 8px;
  background: rgba(255,255,255,0.2);
  color: white;
}

option {
  color: #000;
}

.table-container {
  margin-top: 25px;
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

th {
  background: rgba(255,255,255,0.15);
}

.rk {
  text-align: center;
  margin-top: 10px;
  color: #00eaff;
  text-shadow: 0 0 8px #00eaff;
  font-weight: 600;
}
</style>
</head>

<body>

<div class="app">
  <h1>Job Work Ledger</h1>
  <div class="rk">RK KNIT FAB</div>

  <div class="card">
    <label>Choose Party</label>
    <select id="partySelect"><option>Loading...</option></select>

    <label style="margin-top:15px;">Choose Yarn</label>
    <select id="yarnSelect"><option>Loading...</option></select>
  </div>

  <div class="table-container" id="tableArea"></div>
</div>

<script>
const API = "https://job-workrk.rkknitfabsachin.workers.dev/?action=";

async function loadDropdowns() {
  const parties = await fetch(API + "parties").then(r=>r.json());
  const yarns = await fetch(API + "yarns").then(r=>r.json());

  fillSelect("partySelect", parties.parties);
  fillSelect("yarnSelect", yarns.yarns);
}

function fillSelect(id, arr) {
  const sel = document.getElementById(id);
  sel.innerHTML = `<option value="">-- Select --</option>`;
  arr.forEach(v => sel.innerHTML += `<option>${v}</option>`);
}

async function loadLedger() {
  const res = await fetch(API + "ledger").then(r=>r.json());
  return res.ledger;
}

async function refreshTable() {
  const party = document.getElementById("partySelect").value;
  const yarn  = document.getElementById("yarnSelect").value;

  const ledger = await loadLedger();

  const filtered = ledger.filter(r =>
    (!party || r.party === party) &&
    (!yarn  || r.yarn === yarn)
  );

  renderTable(filtered);
}

function renderTable(rows) {
  let html = `
    <table>
      <tr>
        <th>Date</th><th>Party</th><th>Yarn</th><th>Qty</th><th>Type</th>
      </tr>
  `;

  rows.forEach(r=>{
    html += `
      <tr>
        <td>${r.date}</td>
        <td>${r.party}</td>
        <td>${r.yarn}</td>
        <td>${r.qty}</td>
        <td>${r.type}</td>
      </tr>
    `;
  });

  html += "</table>";

  document.getElementById("tableArea").innerHTML = html;
}

document.getElementById("partySelect").onchange = refreshTable;
document.getElementById("yarnSelect").onchange  = refreshTable;

loadDropdowns().then(refreshTable);
</script>

</body>
</html>
